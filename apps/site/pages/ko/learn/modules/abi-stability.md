---
title: ABI 안정성
layout: learn
---

# ABI 안정성

## 소개

응용 프로그램 바이너리 인터페이스(ABI)는 프로그램이 다른 컴파일된 프로그램의 함수와 데이터 구조를 호출하는 방법입니다. 이는 응용 프로그램 프로그래밍 인터페이스(API)의 컴파일된 버전입니다. 즉, 클래스, 함수, 데이터 구조, 열거형 및 상수를 설명하는 헤더 파일은 응용 프로그램이 원하는 작업을 수행할 수 있도록 하며, 이를 컴파일하면 ABI 제공자가 컴파일된 주소 집합과 예상 매개 변수 값 및 메모리 구조 크기와 레이아웃에 해당합니다.

ABI를 사용하는 응용 프로그램은 제공자의 주소, 예상 매개 변수 값 및 메모리 구조 크기 및 레이아웃과 일치하도록 컴파일되어야 합니다. 이는 일반적으로 ABI 제공자가 제공한 헤더를 기반으로 컴파일하여 이루어집니다.

ABI 제공자와 ABI 사용자는 서로 다른 시간에 서로 다른 컴파일러 버전으로 컴파일될 수 있으므로, ABI 호환성을 보장하는 일부 책임은 컴파일러에 있습니다. 서로 다른 버전의 컴파일러, 즉 서로 다른 공급자가 제공하는 컴파일러는 모두 동일한 헤더 파일 내용에서 동일한 ABI를 생성해야 하며, 응용 프로그램이 헤더에서 설명된 대로 API에 액세스하는 코드를 ABI 규칙에 맞춰 생성해야 합니다. 현대 컴파일러는 자신이 컴파일하는 응용 프로그램의 ABI 호환성을 깨뜨리지 않는 데 상당히 좋은 기록을 가지고 있습니다.

나머지 ABI 호환성 보장의 책임은 API를 제공하는 헤더 파일을 유지 관리하는 팀에 있습니다. 헤더 파일을 변경할 수 있지만, 이러한 변경이 컴파일 시 ABI가 변경되지 않도록 주의 깊게 추적해야 합니다. 그렇지 않으면 기존의 ABI 사용자가 새로운 버전과 호환되지 않을 수 있습니다.

## Node.js의 ABI 안정성

Node.js는 여러 독립적인 팀이 유지 관리하는 헤더 파일을 제공합니다. 예를 들어, `node.h`와 `node_buffer.h`는 Node.js 팀이 유지 관리하며, `v8.h`는 V8 팀이 유지 관리합니다. V8 팀은 Node.js 팀과 긴밀히 협력하지만 독립적이며 자체 일정과 우선 순위를 따릅니다. 따라서 Node.js 팀은 프로젝트에서 제공하는 헤더에 도입된 변경 사항을 부분적으로만 제어할 수 있습니다. 그 결과, Node.js 프로젝트는 [semantic versioning](https://semver.org/)을 채택했습니다. 이는 프로젝트에서 제공하는 API가 동일한 주요 버전 내에서 모든 Node.js 소규모 및 패치 버전에 대해 안정적인 ABI를 생성할 것임을 보장합니다. 실질적으로 이는 Node.js 프로젝트가 주 버전과 관련하여 컴파일된 Node.js 네이티브 애드온이 해당 주 버전 내의 모든 소규모 또는 패치 버전에서 성공적으로 로드될 수 있도록 보장하는 것을 의미합니다.

## N-API

Node.js는 여러 주요 버전에 걸쳐 안정적인 ABI를 제공하는 API에 대한 요구가 있었습니다. 이를 만들기 위한 동기는 다음과 같습니다:

- 자바스크립트 언어는 초기부터 자체적으로 호환성을 유지해왔지만, 자바스크립트 코드를 실행하는 엔진의 ABI는 Node.js의 주요 버전마다 변경됩니다. 이는 자바스크립트로 작성된 Node.js 패키지로만 구성된 응용 프로그램은 Node.js의 새로운 주요 버전이 프로덕션 환경에 도입되어도 재컴파일, 재설치 또는 재배포할 필요가 없음을 의미합니다. 반면, 네이티브 애드온이 포함된 패키지에 의존하는 응용 프로그램은 새로운 주요 버전이 도입될 때마다 재컴파일, 재설치 및 재배포가 필요합니다. 네이티브 애드온이 포함된 Node.js 패키지와 순수 자바스크립트로 작성된 패키지 간의 이러한 차이는 네이티브 애드온을 사용하는 프로덕션 시스템의 유지 보수 부담을 증가시켰습니다.

- 다른 프로젝트들은 본질적으로 Node.js의 대체 구현인 자바스크립트 인터페이스를 만들기 시작했습니다. 이러한 프로젝트들은 일반적으로 V8과는 다른 자바스크립트 엔진을 기반으로 구축되므로, 그들의 네이티브 애드온은 다른 구조를 가지며 다른 API를 사용합니다. 그러나 이러한 프로젝트에서 Node.js 자바스크립트 API의 네이티브 애드온에 단일 API를 사용하는 것은 Node.js 주변에 쌓인 자바스크립트 패키지 생태계를 활용할 수 있게 합니다.

- Node.js는 향후 다른 자바스크립트 엔진을 포함할 수 있습니다. 이는 외부적으로 모든 Node.js 인터페이스가 동일하게 유지되지만 V8 헤더 파일이 없을 수 있음을 의미합니다. 이러한 변화는 JavaScript 엔진에 독립적인 API가 먼저 제공되고 네이티브 애드온이 이를 채택하지 않는 한, 일반적인 Node.js 생태계 및 네이티브 애드온 생태계에 큰 혼란을 초래할 수 있습니다.

이러한 목적을 위해 Node.js는 8.6.0 버전에서 N-API를 도입했으며, 8.12.0 버전에서 이를 프로젝트의 안정적인 구성 요소로 표시했습니다. API는 [`node_api.h`][] 및 [`node_api_types.h`][] 헤더에서 정의되며, Node.js 주요 버전 경계를 넘어서도 호환성을 보장합니다. 이 보장은 다음과 같이 설명할 수 있습니다:

**특정 버전 *n*의 N-API는 해당 버전이 발표된 Node.js 주요 버전과 모든 후속 버전의 Node.js에서 사용할 수 있습니다.**

네이티브 애드온 작성자는 `node_api.h`에 정의된 API와 `node_api_types.h`에 정의된 데이터 구조 및 상수만 사용함으로써 N-API의 향후 호환성 보장을 활용할 수 있습니다. 이렇게 하면 프로덕션 사용자가 네이티브 애드온을 프로젝트에 추가함으로써 응용 프로그램의 유지 보수 부담이 순수 자바스크립트로 작성된 패키지를 추가하는 것보다 더 증가하지 않음을 나타낼 수 있습니다.

N-API는 새로운 API가 때때로 추가되므로 버전이 지정됩니다. 시맨틱 버전 관리와 달리, N-API 버전 관리는 누적 방식입니다. 즉, N-API의 각 버전은 시맨틱 버전 시스템에서 소규모 버전과 같은 의미를 가지며, N-API에 이루어진 모든 변경 사항은 이전 버전과 호환됩니다. 또한 새로운 N-API는 실험적 플래그 아래에 추가되어 커뮤니티가 프로덕션 환경에서 이를 검증할 수 있는 기회를 제공합니다. 실험적 상태는 새로운 API가 미래에 ABI 비호환 방식으로 수정되지 않도록 신중을 기했음을 의미하지만, 설계된 대로 올바르고 유용함이 충분히 입증되지 않았으며, 따라서 실험적 N-API는 최종적으로 향후 N-API 버전에 통합되기 전에 ABI 비호환 변경이 발생할 수 있음을 의미합니다. 즉, 실험적 N-API는 아직 향후 호환성 보장의 대상이 아닙니다.

[`node_api.h`]: https://github.com/nodejs/node/blob/main/src/node_api.h
[`node_api_types.h`]: https://github.com/nodejs/node/blob/main/src/node_api_types.h
